CREATE DATABASE club_Manager;
USE club_Manager;

-- T?o b?ng Settings (B?ng 1)
CREATE TABLE Settings (
    SettingID INT AUTO_INCREMENT PRIMARY KEY,
    SettingName VARCHAR(100) NOT NULL,
    SettingType ENUM('String', 'Integer', 'Boolean', 'Date', 'Text') NOT NULL, -- Lo?i d? li?u c?a setting
    SettingValue TEXT NOT NULL, -- Giá tr? c?a setting
    Priority INT DEFAULT 1, -- M?c d? uu tiên c?a setting
    Status ENUM('Active', 'Inactive') DEFAULT 'Active', -- Tr?ng thái c?a setting
    UserType ENUM('Admin', 'ClubLeader', 'ClubMember', 'WebUser') NOT NULL -- Lo?i ngu?i dùng áp d?ng setting
);

-- T?o b?ng Users (B?ng N)
CREATE TABLE Users (
    UserID INT AUTO_INCREMENT PRIMARY KEY,
    Username VARCHAR(50) NOT NULL,
    Password VARCHAR(255) NOT NULL,
    Email VARCHAR(100) NOT NULL UNIQUE,
    UserType ENUM('Admin', 'ClubLeader', 'ClubMember', 'WebUser') DEFAULT 'WebUser', -- Lo?i ngu?i dùng
    SettingID INT, -- Khóa ngo?i liên k?t d?n b?ng Settings
    CreatedDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    LastLoginDate DATETIME DEFAULT NULL,
    AccountCreatedDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    AccountLastModifiedDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    Status ENUM('Active', 'Suspended', 'Inactive') DEFAULT 'Active', -- Tr?ng thái tài kho?n ngu?i dùng
    ImageURL VARCHAR(255), -- Luu tr? ?nh ngu?i dùng
    FOREIGN KEY (SettingID) REFERENCES Settings(SettingID) ON DELETE SET NULL -- Thi?t l?p FK d?n b?ng Settings
);

-- T?o b?ng Clubs
CREATE TABLE Clubs (
    ClubID INT AUTO_INCREMENT PRIMARY KEY,
    ClubName VARCHAR(100) NOT NULL,
    Description TEXT,
    CreatedDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    IsPublic BOOLEAN DEFAULT TRUE,
    LastModifiedDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    ImageURL VARCHAR(255) -- Luu tr? ?nh câu l?c b?
);

-- T?o b?ng UserClubs (Quan h? N-N gi?a Users và Clubs)
CREATE TABLE UserClubs (
    UserID INT, -- Khóa ngo?i liên k?t d?n b?ng Users
    ClubID INT, -- Khóa ngo?i liên k?t d?n b?ng Clubs
    JoinedDate DATETIME DEFAULT CURRENT_TIMESTAMP, -- Ngày gia nh?p
    PRIMARY KEY (UserID, ClubID), -- Khóa chính là s? k?t h?p gi?a UserID và ClubID
    FOREIGN KEY (UserID) REFERENCES Users(UserID) ON DELETE CASCADE,
    FOREIGN KEY (ClubID) REFERENCES Clubs(ClubID) ON DELETE CASCADE
);

-- T?o b?ng Events
CREATE TABLE Events (
    EventID INT AUTO_INCREMENT PRIMARY KEY,
    ClubID INT NOT NULL, -- Khóa ngo?i liên k?t d?n b?ng Clubs
    EventName VARCHAR(100) NOT NULL,
    Description TEXT,
    EventDate DATETIME NOT NULL,
    CreatedBy INT, -- Khóa ngo?i liên k?t d?n b?ng Users (ngu?i t?o)
    CreatedDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ClubID) REFERENCES Clubs(ClubID) ON DELETE CASCADE,
    FOREIGN KEY (CreatedBy) REFERENCES Users(UserID) ON DELETE SET NULL
);

-- B? các ràng bu?c d? xóa các b?ng n?u c?n
SET FOREIGN_KEY_CHECKS = 0;

-- Xóa các b?ng cu n?u t?n t?i
DROP TABLE IF EXISTS Events;
DROP TABLE IF EXISTS UserClubs;
DROP TABLE IF EXISTS Users;
DROP TABLE IF EXISTS Clubs;
DROP TABLE IF EXISTS Settings;

SET FOREIGN_KEY_CHECKS = 1;